package br.ufla.tmsmap.test;

import br.ufla.tmsmap.*;
import com.vividsolutions.jts.geom.Envelope;
import com.vividsolutions.jts.geom.Geometry;
import org.geotools.referencing.crs.DefaultGeographicCRS;
import org.testng.annotations.Test;

import java.awt.*;
import java.io.File;
import java.io.IOException;
import java.net.URL;

/**
 * Created by marcio on 26/02/19.
 * ReferÃªncia: https://docs.geoserver.org/latest/en/user/styling/sld/extensions/pointsymbols.html
 */
public class FillSymbolyzerTest {

	public static final String GeoJSON01 = "{\"type\":\"MultiPolygon\",\"coordinates\":[[[[-53.516112720899145,-5.952468049792358],[-53.516112721066747,-5.952468051620593],[-53.516112721565747,-5.952468053387377],[-53.51611272237934,-5.95246805503316],[-53.516112723480092,-5.952468056502471],[-53.516563211318676,-5.952966516193238],[-53.516563212673042,-5.952966517439269],[-53.516563214232818,-5.952966518416003],[-53.516563215945169,-5.952966519090362],[-53.516563217752108,-5.952966519439503],[-53.51656321959242,-5.952966519451602],[-53.516563221403793,-5.95296651912625],[-53.516563223124862,-5.952966518474466],[-53.516563224697343,-5.952966517518324],[-53.516564590525597,-5.952965503859656],[-53.516564590630296,-5.952965503780886],[-53.516939415207624,-5.952679634154338],[-53.516939415339372,-5.952679634052108],[-53.518337628451867,-5.95157589290474],[-53.518337629804044,-5.951575891614884],[-53.518337630892631,-5.951575890095972],[-53.518337631679607,-5.951575888401045],[-53.518337632137495,-5.951575886589291],[-53.518337632250308,-5.951575884723979],[-53.517772736892525,-5.934551343463067],[-53.517772736622049,-5.934551341461617],[-53.517772735954942,-5.934551339555332],[-53.517772734918402,-5.934551337821969],[-53.517772733554722,-5.934551336332232],[-53.517772731919514,-5.934551335146884],[-53.517772730079479,-5.934551334314278],[-53.517772728109676,-5.934551333868373],[-53.517772726090449,-5.934551333827359],[-53.517772724104162,-5.934551334192908],[-53.51777272223184,-5.93455133495011],[-53.516220154740559,-5.935370431172248],[-53.516220152971172,-5.935370432362852],[-53.516220151494494,-5.93537043390158],[-53.516220150377684,-5.935370435718447],[-53.51622014967154,-5.935370437730815],[-53.516220149408184,-5.935370439847158],[-53.516118345616214,-5.941369453217219],[-53.516118345614771,-5.941369453381828],[-53.516112720899145,-5.952468049792358]]],[[[-53.522160391407731,-5.96124815979922],[-53.526582060931247,-5.971453240904024],[-53.526582061843371,-5.971453242559773],[-53.526582063050803,-5.971453244014282],[-53.526582064510379,-5.971453245215578],[-53.526582066169951,-5.971453246120731],[-53.52658206797021,-5.971453246697397],[-53.526582069846825,-5.971453246924968],[-53.52658207173274,-5.971453246795313],[-53.526582073560554,-5.971453246313064],[-53.529554749647438,-5.970359300983809],[-53.529554750443026,-5.970359300651422],[-53.535597164533883,-5.96752298805348],[-53.535597165241256,-5.967522987686356],[-53.538550323769108,-5.965837656365812],[-53.538550325357093,-5.965837655241644],[-53.538550326697333,-5.965837653831258],[-53.538550327739102,-5.965837652188043],[-53.538550328442966,-5.965837650374201],[-53.538550328782271,-5.965837648458396],[-53.538550328744186,-5.965837646513148],[-53.538550328330139,-5.965837644612093],[-53.538550327555818,-5.965837642827196],[-53.538550326450519,-5.96583764122602],[-53.533446756099636,-5.959798402204396],[-53.52654974041338,-5.951003368111691],[-53.526549739720132,-5.951003367317691],[-53.524223547243892,-5.94860672692044],[-53.52422354565082,-5.948606725588643],[-53.524223543817044,-5.948606724614562],[-53.524223541821627,-5.948606724040193],[-53.524223539750615,-5.948606723890301],[-53.524223537693288,-5.948606724171349],[-53.524223535738358,-5.948606724871218],[-53.519070020984302,-5.951082155413633],[-53.519070019300138,-5.95108215643816],[-53.516944637943631,-5.952681997674448],[-53.5169446377773,-5.952681997802403],[-53.516571324140052,-5.952975474574088],[-53.516571322784003,-5.952975475862698],[-53.516571321691679,-5.95297547738132],[-53.516571320901306,-5.952975479076811],[-53.516571320440534,-5.952975480889841],[-53.516571320325504,-5.952975482756965],[-53.516571320560224,-5.952975484612845],[-53.516571321136496,-5.952975486392536],[-53.516571322034139,-5.952975488033761],[-53.518422134354786,-5.95571501692319],[-53.51842213568294,-5.955715018507384],[-53.518422137308455,-5.95571501978463],[-53.519450285628807,-5.956363119253007],[-53.520548440174039,-5.957962960016428],[-53.522160391407731,-5.96124815979922]]],[[[-53.545297053353934,-5.975747536208294],[-53.54475162589457,-5.980564551765289],[-53.540320274301955,-5.980339895490003],[-53.538969718189904,-5.977136467582588],[-53.538969717223019,-5.977136465812702],[-53.538969715920679,-5.977136464272813],[-53.538969714335842,-5.977136463025555],[-53.538969712532975,-5.977136462121657],[-53.538969710585405,-5.977136461597885],[-53.538969708572345,-5.977136461475543],[-53.538969706575685,-5.977136461759606],[-53.538969704676624,-5.977136462438522],[-53.538969702952407,-5.977136463484674],[-53.538969701473164,-5.977136464855514],[-53.536444932410923,-5.980001187186344],[-53.535026189252612,-5.981322820055221],[-53.532900626554984,-5.981444081283406],[-53.531198205318979,-5.979178401688741],[-53.531198204064481,-5.979178400308695],[-53.531198202575538,-5.979178399185597],[-53.531198200903944,-5.979178398358512],[-53.531198199107841,-5.979178397856208],[-53.531198197249701,-5.979178397696157],[-53.531198195394161,-5.979178397883926],[-53.531198193605753,-5.979178398412984],[-53.531198191946693,-5.979178399264928],[-53.531198190474676,-5.979178400410126],[-53.531198189240918,-5.979178401808745],[-53.530402706351047,-5.980270651839787],[-53.530402705310898,-5.980270653632956],[-53.530402704662826,-5.980270655602057],[-53.530402704434671,-5.98027065766247],[-53.530402704636245,-5.980270659725655],[-53.530402705258886,-5.980270661702946],[-53.53330346860843,-5.986964830502112],[-53.530658813806838,-5.999614101315344],[-53.527208853364044,-6.008590067405487],[-53.527208852848233,-6.008590069268108],[-53.527208852700355,-6.008590071195166],[-53.527208852925945,-6.008590073114679],[-53.527208853516576,-6.008590074954943],[-53.527208854450187,-6.008590076647219],[-53.527208855691896,-6.008590078128292],[-53.527208857195326,-6.008590079342838],[-53.527208858904309,-6.008590080245488],[-53.527208860755024,-6.008590080802526],[-53.527208862678322,-6.008590080993144],[-53.55110715398785,-6.008637863299255],[-53.551107155795073,-6.00863786313827],[-53.551107157543463,-6.008637862653388],[-53.551107159175459,-6.008637861860572],[-53.551107160637336,-6.00863786078592],[-53.551107161880978,-6.00863785946481],[-53.551107162865435,-6.008637857940734],[-53.557316660931662,-5.996787883259934],[-53.557316661679209,-5.996787881400794],[-53.557316662041096,-5.996787879429938],[-53.557316662002776,-5.9967878774265],[-53.5573166615658,-5.996787875470923],[-53.548793000617628,-5.971084001955863],[-53.548792999816214,-5.971084000155847],[-53.548792998677413,-5.971083998547912],[-53.548792997245442,-5.971083997194483],[-53.548792995575887,-5.971083996148104],[-53.548792993733571,-5.971083995449398],[-53.548792991790016,-5.971083995125492],[-53.548792989820676,-5.971083995188962],[-53.548792987902011,-5.971083995637342],[-53.548792986108509,-5.971083996453227],[-53.545151691682882,-5.973196066332306],[-53.545151690568808,-5.973196067082805],[-53.543909436107377,-5.974160262237367],[-53.543909434636447,-5.974160263640624],[-53.543909433479712,-5.974160265312365],[-53.54390943268497,-5.974160267183499],[-53.543909432285062,-5.974160269176696],[-53.543909432296523,-5.974160271209582],[-53.543909432718877,-5.974160273198144],[-53.543909433534665,-5.974160275060198],[-53.54390943471018,-5.974160276718789],[-53.545297053353934,-5.975747536208294]]],[[[-53.548158835737638,-5.936148425798205],[-53.546734780207011,-5.936288721865718],[-53.545774709606199,-5.935669042545007],[-53.545774709018403,-5.935669042193524],[-53.544614194026352,-5.935027993887581],[-53.544426394032435,-5.932911370568003],[-53.544426393697563,-5.932911368742512],[-53.544426393031117,-5.932911367010345],[-53.544426392056053,-5.932911365431164],[-53.54442639080596,-5.932911364059368],[-53.544426389323895,-5.932911362942209],[-53.544426387660913,-5.932911362118166],[-53.544426385874296,-5.932911361615626],[-53.544426384025577,-5.932911361451898],[-53.543535964652811,-5.932915455939771],[-53.541907166208205,-5.932098233855009],[-53.541907164293072,-5.932098233128801],[-53.541907162270149,-5.932098232808019],[-53.538901168704349,-5.931933718262832],[-53.538901167656199,-5.931933718260481],[-53.532804534077158,-5.932239961045568],[-53.532804532172221,-5.932239961326884],[-53.532804530356522,-5.932239961968094],[-53.532804528697383,-5.932239962945421],[-53.532804527256324,-5.932239964222629],[-53.532804526086778,-5.932239965752357],[-53.532804525232109,-5.932239967477887],[-53.532804524724007,-5.932239969335236],[-53.532804524581316,-5.932239971255536],[-53.532886644249004,-5.935928840549652],[-53.532886644251775,-5.935928840651051],[-53.533210623721956,-5.945924234405331],[-53.533210623968152,-5.945924236309761],[-53.533210624573826,-5.94592423813202],[-53.533210625516638,-5.945924239804913],[-53.533210626761829,-5.945924241266751],[-53.533210628263475,-5.945924242463632],[-53.533210629966206,-5.945924243351419],[-53.533210631807236,-5.945924243897377],[-53.533210633718681,-5.945924244081373],[-53.540812972906934,-5.94592274041639],[-53.541012970626376,-5.950691751544439],[-53.541176361077511,-5.957177224564458],[-53.540677779507554,-5.960099433920662],[-53.538476950353264,-5.960778264893986],[-53.538476948544009,-5.960778265653501],[-53.538476946917903,-5.960778266751694],[-53.538476945537546,-5.960778268146282],[-53.538476944456093,-5.960778269783569],[-53.538476943715182,-5.960778271600517],[-53.538476943343333,-5.960778273527167],[-53.538476943354866,-5.960778275489339],[-53.538546803696825,-5.961446637826725],[-53.538546804132146,-5.961446639877537],[-53.538546804985494,-5.961446641792516],[-53.538546806219344,-5.961446643487491],[-53.538546807779476,-5.961446644887965],[-53.538546809597314,-5.961446645932378],[-53.538546811592958,-5.961446646574829],[-53.538546813678693,-5.961446646787078],[-53.560296494949625,-5.961368234232761],[-53.560296496901074,-5.961368234033328],[-53.560296498776047,-5.961368233456779],[-53.560296500502396,-5.961368232525297],[-53.560296502013685,-5.961368231274728],[-53.56029650325177,-5.961368229753192],[-53.56029650416901,-5.961368228019235],[-53.560296504730104,-5.96136822613958],[-53.560296504913467,-5.961368224186555],[-53.560164701088276,-5.932883342541047],[-53.560164700939467,-5.932883340867999],[-53.559503596060893,-5.92909544510135],[-53.559503595562738,-5.929095443281929],[-53.559503594731758,-5.929095441588433],[-53.559503593597533,-5.929095440081123],[-53.559503592200421,-5.929095438813637],[-53.559503590590133,-5.929095437831077],[-53.559503588823972,-5.929095437168408],[-53.559503586964787,-5.92909543684921],[-53.556233755698685,-5.92884786502901],[-53.556233753372965,-5.928847865124601],[-53.556233751132346,-5.92884786575528],[-53.552850993065491,-5.9302424195829],[-53.551295129774836,-5.930762247016101],[-53.551295128389022,-5.930762247598218],[-53.551295127106116,-5.930762248381471],[-53.550296690377003,-5.931480107795072],[-53.550296689127691,-5.931480108859153],[-53.550296688069231,-5.931480110113232],[-53.55029668723013,-5.931480111523537],[-53.549194013934432,-5.933736413274305],[-53.549194013729483,-5.93373641372121],[-53.548158835737638,-5.936148425798205]]]]}";

	@Test
	public void fillSymbolBackSlash() throws IOException {
		TMSMap tmsMap = new TMSMap();

		tmsMap.addLayer(TMSLayer.from(new URL("http://www.car.gov.br/mosaicos/{z}/{x}/{y}.jpg")));
		Geometry geometry = JTSTest.geomFromGeoJSON(GeoJSON01);

		Style style = new PolygonStyle()
			.setShapeSymbolFill("shape://backslash", new Color(0xFF4921), 8, null, 1, 0.6f, new float[]{5,10})
			.color(new Color(0xFF4921))
			.opacity(0.6f)
			.width(2);

		tmsMap.addLayer(JTSLayer.from(DefaultGeographicCRS.WGS84, style, geometry));

		Envelope env = geometry.getEnvelopeInternal();
		env.expandBy(0.01D);

		tmsMap.zoom(env, 15);

		tmsMap.render(1000, 1000, File.createTempFile("TMS-fillSymbolBackSlash", ".png"));
	}

	@Test
	public void fillSymbolSlash() throws IOException {
		TMSMap tmsMap = new TMSMap();

		tmsMap.addLayer(TMSLayer.from(new URL("http://www.car.gov.br/mosaicos/{z}/{x}/{y}.jpg")));
		Geometry geometry = JTSTest.geomFromGeoJSON(GeoJSON01);

		Style style = new PolygonStyle()
			.fillColor(new Color(0x97FF33))
			.setShapeSymbolFill("shape://slash", new Color(0xFF4921), 8, null, 1, 0.6f, new float[]{5,10})
			.color(new Color(0xFF4921))
			.opacity(0.6f)
			.width(2);

		tmsMap.addLayer(JTSLayer.from(DefaultGeographicCRS.WGS84, style, geometry));

		Envelope env = geometry.getEnvelopeInternal();
		env.expandBy(0.01D);

		tmsMap.zoom(env, 15);

		tmsMap.render(1000, 1000, File.createTempFile("TMS-fillSymbolSlash", ".png"));
	}

}
